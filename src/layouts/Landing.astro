---
import '../styles/global.css';
import LanguageSwitcher from '../components/LanguageSwitcher.astro';

export interface Props {
  title: string;
  lang: 'ru' | 'en' | 'de' | 'fr';
  canonicalUrl?: string;
  meta?: {
    description?: string;
    keywords?: string;
    ogImage?: string;
  };
}

const { title, lang, canonicalUrl, meta } = Astro.props;

// Базовые мета-теги по языку
const defaultMeta = {
  ru: {
    description: 'Бесплатная транскрипция аудио с ИИ. 98 языков, 95%+ точность. Telegram бот AudioTextAI',
    keywords: 'транскрипция аудио, голосовые сообщения, ИИ, телеграм бот, 98 языков, бесплатно, AudioTextAI',
  },
  en: {
    description: 'Free AI audio transcription. 98 languages, 95%+ accuracy. AudioTextAI Telegram bot',
    keywords: 'audio transcription, voice messages, AI, telegram bot, 98 languages, free, AudioTextAI',
  },
  de: {
    description: 'Kostenlose KI Audio-Transkription. 98 Sprachen, 95%+ Genauigkeit. AudioTextAI Telegram Bot',
    keywords: 'audio transkription, sprachnachrichten, KI, telegram bot, 98 sprachen, kostenlos, AudioTextAI',
  },
  fr: {
    description: 'Transcription Audio IA Gratuite. 98 langues, 95%+ de précision. Bot Telegram AudioTextAI',
    keywords: 'transcription audio, messages vocaux, IA, bot telegram, 98 langues, gratuit, AudioTextAI',
  },
};

const currentMeta = {
  description: meta?.description || defaultMeta[lang].description,
  keywords: meta?.keywords || defaultMeta[lang].keywords,
  ogImage: meta?.ogImage || 'https://audiotextai.site/logo.png',
};

const fullUrl = canonicalUrl || `https://audiotextai.site/${lang}`;

// JSON-LD схемы
const baseUrl = 'https://audiotextai.site';
const logoUrl = `${baseUrl}/logo.png`;

const organizationSchema = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "AudioTextAI",
  "description": currentMeta.description,
  "url": fullUrl,
  "logo": logoUrl,
  "sameAs": ["https://t.me/AudioTextAI_bot"],
  "contactPoint": {
    "@type": "ContactPoint", 
    "contactType": "customer service",
    "url": "https://t.me/AudioTextAI_bot"
  }
};

const websiteSchema = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "AudioTextAI",
  "description": currentMeta.description,
  "url": fullUrl,
  "inLanguage": lang === 'ru' ? 'ru-RU' : lang === 'de' ? 'de-DE' : lang === 'fr' ? 'fr-FR' : 'en-US'
};

const softwareSchema = {
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": lang === 'ru' ? "AudioTextAI Telegram Бот" : lang === 'de' ? "AudioTextAI Telegram Bot" : lang === 'fr' ? "AudioTextAI Bot Telegram" : "AudioTextAI Telegram Bot",
  "description": currentMeta.description,
  "url": "https://t.me/AudioTextAI_bot",
  "applicationCategory": "ProductivityApplication",
  "operatingSystem": "Telegram",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": lang === 'ru' ? 'RUB' : lang === 'de' ? 'EUR' : lang === 'fr' ? 'EUR' : 'USD',
    "availability": "https://schema.org/InStock"
  },
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "4.8",
    "reviewCount": "150",
    "bestRating": "5"
  }
};

// Преобразуем схемы в JSON строки
const organizationJsonLD = JSON.stringify(organizationSchema);
const websiteJsonLD = JSON.stringify(websiteSchema);
const softwareJsonLD = JSON.stringify(softwareSchema);
---

<!DOCTYPE html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title}</title>
    <meta name="description" content={currentMeta.description} />
    <meta name="keywords" content={currentMeta.keywords} />
    <link rel="canonical" href={fullUrl} />
    
    <!-- Hreflang для мультиязычного SEO -->
    <link rel="alternate" hreflang="en" href="https://audiotextai.site/en/" />
    <link rel="alternate" hreflang="ru" href="https://audiotextai.site/ru/" />
    <link rel="alternate" hreflang="de" href="https://audiotextai.site/de/" />
    <link rel="alternate" hreflang="fr" href="https://audiotextai.site/fr/" />
    <link rel="alternate" hreflang="x-default" href="https://audiotextai.site/en/" />
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon_16.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon_32.png" />
    <link rel="icon" type="image/png" sizes="48x48" href="/favicon_48.png" />
    <link rel="icon" type="image/png" sizes="64x64" href="/favicon_64.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/logo.png" />
    
    <!-- Open Graph -->
    <meta property="og:title" content={title} />
    <meta property="og:description" content={currentMeta.description} />
    <meta property="og:image" content={currentMeta.ogImage} />
    <meta property="og:url" content={fullUrl} />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content={lang === 'ru' ? 'ru_RU' : lang === 'de' ? 'de_DE' : lang === 'fr' ? 'fr_FR' : 'en_US'} />
    <meta property="og:site_name" content="AudioTextAI" />
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={currentMeta.description} />
    <meta name="twitter:image" content={currentMeta.ogImage} />
    
    <!-- Additional SEO -->
    <meta name="robots" content="index, follow" />
    <meta name="author" content="AudioTextAI" />
    <meta name="language" content={lang} />
    <meta name="theme-color" content="#6366f1" />
    
    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json" set:html={organizationJsonLD}></script>
    <script type="application/ld+json" set:html={websiteJsonLD}></script>
    <script type="application/ld+json" set:html={softwareJsonLD}></script>
  </head>
  <body class="bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 dark:from-gray-900 dark:via-purple-900 dark:to-blue-900 min-h-screen">
    <!-- Language Switcher -->
    <div class="fixed top-4 right-4 z-50">
      <LanguageSwitcher currentLang={lang} currentPath={Astro.url.pathname} variant="dropdown" />
    </div>
    
    <slot />
  </body>
</html>